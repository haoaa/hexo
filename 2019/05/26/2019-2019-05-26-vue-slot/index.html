<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="vue slot," />










<meta name="description" content="普通slot
父组件update的时候已经创建了vnode, 子组件render的时候直接从$slot返回对应的vnode

父组件parse 阶段
往ast节点添加属性slot=slottarget, gendata生成对应字符串
compile完 render, 创建子组件vnode后, 开始渲染子组件

123456789function processElement (  element,">
<meta property="og:type" content="article">
<meta property="og:title" content="vue-slot">
<meta property="og:url" content="https://haoaa.github.io/hexo/2019/05/26/2019-2019-05-26-vue-slot/index.html">
<meta property="og:site_name" content="Haoqi's blog-ish!">
<meta property="og:description" content="普通slot
父组件update的时候已经创建了vnode, 子组件render的时候直接从$slot返回对应的vnode

父组件parse 阶段
往ast节点添加属性slot=slottarget, gendata生成对应字符串
compile完 render, 创建子组件vnode后, 开始渲染子组件

123456789function processElement (  element,">
<meta property="og:updated_time" content="2019-09-15T10:12:57.611Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="vue-slot">
<meta name="twitter:description" content="普通slot
父组件update的时候已经创建了vnode, 子组件render的时候直接从$slot返回对应的vnode

父组件parse 阶段
往ast节点添加属性slot=slottarget, gendata生成对应字符串
compile完 render, 创建子组件vnode后, 开始渲染子组件

123456789function processElement (  element,">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://haoaa.github.io/hexo/2019/05/26/2019-2019-05-26-vue-slot/"/>





  <title>vue-slot | Haoqi's blog-ish!</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <audio src="\assets\2019\Indian_Summer.mp3"></audio>
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Haoqi's blog-ish!</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">blah blah blah</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>




<script>
  let hasClick = 0 
  document.querySelector('.site-subtitle').onclick = ()=>{
    hasClick++
    if(hasClick === 3) {
      document.querySelector('audio').play()
    }
  }

</script> </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://haoaa.github.io/hexo/2019/05/26/2019-2019-05-26-vue-slot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="浩齐">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Haoqi's blog-ish!">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">vue-slot</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-26T11:04:16+08:00">
                2019-05-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/vue-slot/" itemprop="url" rel="index">
                    <span itemprop="name">vue slot</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="普通slot"><a href="#普通slot" class="headerlink" title="普通slot"></a>普通slot</h2><ul>
<li>父组件update的时候已经创建了vnode, 子组件render的时候直接从$slot返回对应的vnode</li>
</ul>
<h3 id="父组件parse-阶段"><a href="#父组件parse-阶段" class="headerlink" title="父组件parse 阶段"></a>父组件parse 阶段</h3><ul>
<li>往ast节点添加属性slot=slottarget, gendata生成对应字符串</li>
<li>compile完 render, 创建子组件vnode后, 开始渲染子组件</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">processElement</span> (<span class="params"></span></span></div><div class="line">  element,</div><div class="line">  options</div><div class="line">) &#123;</div><div class="line">  processSlotContent(element);</div><div class="line">  processSlotOutlet(element);</div><div class="line">  processAttrs(element);</div><div class="line">  <span class="keyword">return</span> element</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// handle content being passed to a component as slot,</span></div><div class="line"><span class="comment">// e.g. &lt;template slot="xxx"&gt;, &lt;div slot-scope="xxx"&gt;</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">processSlotContent</span> (<span class="params">el</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> slotScope;</div><div class="line">  <span class="keyword">if</span> (el.tag === <span class="string">'template'</span>) &#123;</div><div class="line">    slotScope = getAndRemoveAttr(el, <span class="string">'scope'</span>);</div><div class="line">    el.slotScope = slotScope || getAndRemoveAttr(el, <span class="string">'slot-scope'</span>);</div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((slotScope = getAndRemoveAttr(el, <span class="string">'slot-scope'</span>))) &#123;</div><div class="line">    el.slotScope = slotScope;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// slot="xxx"</span></div><div class="line">  <span class="keyword">var</span> slotTarget = getBindingAttr(el, <span class="string">'slot'</span>);</div><div class="line">  <span class="keyword">if</span> (slotTarget) &#123;</div><div class="line">    el.slotTarget = slotTarget === <span class="string">'""'</span> ? <span class="string">'"default"'</span> : slotTarget;</div><div class="line">    el.slotTargetDynamic = !!(el.attrsMap[<span class="string">':slot'</span>] || el.attrsMap[<span class="string">'v-bind:slot'</span>]);</div><div class="line">    <span class="comment">// preserve slot as an attribute for native shadow DOM compat</span></div><div class="line">    <span class="comment">// only for non-scoped slots.</span></div><div class="line">    <span class="keyword">if</span> (el.tag !== <span class="string">'template'</span> &amp;&amp; !el.slotScope) &#123;</div><div class="line">      addAttr(el, <span class="string">'slot'</span>, slotTarget, getRawBindingAttr(el, <span class="string">'slot'</span>));</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="genData-阶段"><a href="#genData-阶段" class="headerlink" title="genData 阶段"></a>genData 阶段</h3><ul>
<li>添加代码<code>&quot;slot:&quot; + (el.slotTarget) + &quot;,</code>到render字符串中</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">genData$2</span> (<span class="params">el, state</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> data = <span class="string">'&#123;'</span>;</div><div class="line"></div><div class="line">  <span class="comment">// slot target</span></div><div class="line">  <span class="comment">// only for non-scoped slots</span></div><div class="line">  <span class="keyword">if</span> (el.slotTarget &amp;&amp; !el.slotScope) &#123;</div><div class="line">    data += <span class="string">"slot:"</span> + (el.slotTarget) + <span class="string">","</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// parse=&gt; ast, ast-gencode=&gt;</span></div><div class="line"><span class="keyword">with</span>(<span class="keyword">this</span>)&#123;</div><div class="line">  <span class="keyword">return</span> _c(<span class="string">'div'</span>,</div><div class="line">    [_c(<span class="string">'app-layout'</span>,</div><div class="line">      [_c(<span class="string">'h1'</span>,&#123;<span class="attr">attrs</span>:&#123;<span class="string">"slot"</span>:<span class="string">"header"</span>&#125;,<span class="attr">slot</span>:<span class="string">"header"</span>&#125;,</div><div class="line">         [_v(_s(title))]),</div><div class="line">       _c(<span class="string">'p'</span>,[_v(_s(msg))]),</div><div class="line">       _c(<span class="string">'p'</span>,&#123;<span class="attr">attrs</span>:&#123;<span class="string">"slot"</span>:<span class="string">"footer"</span>&#125;,<span class="attr">slot</span>:<span class="string">"footer"</span>&#125;,</div><div class="line">         [_v(_s(desc))]</div><div class="line">         )</div><div class="line">       ])</div><div class="line">     ],</div><div class="line">   <span class="number">1</span>)&#125;</div></pre></td></tr></table></figure>
<h3 id="子组件-compile-parse和gencode阶段"><a href="#子组件-compile-parse和gencode阶段" class="headerlink" title="子组件(compile) parse和gencode阶段"></a>子组件(compile) parse和gencode阶段</h3><ul>
<li>子组件在实例化的_init设置了$slots<ul>
<li><code>initRender: vm.$slots = resolveSlots(options._renderChildren, renderContext);</code></li>
</ul>
</li>
<li>parse时slot ast节点添加slotName属性</li>
<li>gencode拼上_t</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">processSlotOutlet</span> (<span class="params">el</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (el.tag === <span class="string">'slot'</span>) &#123;</div><div class="line">    el.slotName = getBindingAttr(el, <span class="string">'name'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// gencode</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">genElement</span> (<span class="params">el, state</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (el.tag === <span class="string">'slot'</span>) &#123;</div><div class="line">    <span class="keyword">return</span> genSlot(el, state)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">genSlot</span> (<span class="params">el, state</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> slotName = el.slotName || <span class="string">'"default"'</span>;</div><div class="line">  <span class="keyword">var</span> children = genChildren(el, state); <span class="comment">// slot包裹子节点</span></div><div class="line">  <span class="keyword">var</span> res = <span class="string">"_t("</span> + slotName + (children ? (<span class="string">","</span> + children) : <span class="string">''</span>);</div><div class="line">  <span class="keyword">var</span> attrs = el.attrs || el.dynamicAttrs</div><div class="line">    ? genProps((el.attrs || []).concat(el.dynamicAttrs || []).map(<span class="function"><span class="keyword">function</span> (<span class="params">attr</span>) </span>&#123; <span class="keyword">return</span> (&#123;</div><div class="line">        <span class="comment">// slot props are camelized</span></div><div class="line">        name: camelize(attr.name),</div><div class="line">        <span class="attr">value</span>: attr.value,</div><div class="line">        <span class="attr">dynamic</span>: attr.dynamic</div><div class="line">      &#125;); &#125;))</div><div class="line">    : <span class="literal">null</span>;</div><div class="line">  <span class="keyword">var</span> bind$$<span class="number">1</span> = el.attrsMap[<span class="string">'v-bind'</span>];</div><div class="line">  <span class="keyword">if</span> ((attrs || bind$$<span class="number">1</span>) &amp;&amp; !children) &#123;</div><div class="line">    res += <span class="string">",null"</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">if</span> (attrs) &#123;</div><div class="line">    res += <span class="string">","</span> + attrs;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">if</span> (bind$$<span class="number">1</span>) &#123;</div><div class="line">    res += (attrs ? <span class="string">''</span> : <span class="string">',null'</span>) + <span class="string">","</span> + bind$$<span class="number">1</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> res + <span class="string">')'</span></div><div class="line">&#125;</div><div class="line"><span class="comment">// _t("header", children, attrs)</span></div><div class="line"></div><div class="line"><span class="comment">// 最终code</span></div><div class="line"><span class="keyword">with</span>(<span class="keyword">this</span>) &#123;</div><div class="line">  <span class="keyword">return</span> _c(<span class="string">'div'</span>,&#123;</div><div class="line">    <span class="attr">staticClass</span>:<span class="string">"container"</span></div><div class="line">    &#125;,[</div><div class="line">      _c(<span class="string">'header'</span>,[_t(<span class="string">"header"</span>)],<span class="number">2</span>),</div><div class="line">      _c(<span class="string">'main'</span>,[_t(<span class="string">"default"</span>,[_v(<span class="string">"默认内容"</span>)])],<span class="number">2</span>),</div><div class="line">      _c(<span class="string">'footer'</span>,[_t(<span class="string">"footer"</span>)],<span class="number">2</span>)</div><div class="line">      ]</div><div class="line">   )</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="运行时实现-子组件"><a href="#运行时实现-子组件" class="headerlink" title="运行时实现(子组件)"></a>运行时实现(子组件)</h3><ul>
<li>普通slot渲染时, 通过$slot返回父组件传过来的children vnode.</li>
<li>运行(调用render方法)时通过_t(renderSlot)生成vnode </li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// _t方法</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderSlot</span> : <span class="title">vnode</span>(<span class="params"></span></span></div><div class="line">  name,</div><div class="line">  fallback, <span class="regexp">//</span> slot包裹内容</div><div class="line">  props,</div><div class="line">  bindObject</div><div class="line">) &#123;</div><div class="line">  <span class="keyword">var</span> scopedSlotFn = <span class="keyword">this</span>.$scopedSlots[name]; <span class="comment">// scope-slot的render方法</span></div><div class="line">  <span class="keyword">var</span> nodes;</div><div class="line">  <span class="keyword">if</span> (scopedSlotFn) &#123; <span class="comment">// 2.6后scope-slot和slot都在scopedSlots里</span></div><div class="line">    props = props || &#123;&#125;;</div><div class="line">    <span class="keyword">if</span> (bindObject) &#123;</div><div class="line">      <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; !isObject(bindObject)) &#123;</div><div class="line">        warn(</div><div class="line">          <span class="string">'slot v-bind without argument expects an Object'</span>,</div><div class="line">          <span class="keyword">this</span></div><div class="line">        );</div><div class="line">      &#125;</div><div class="line">      props = extend(extend(&#123;&#125;, bindObject), props);</div><div class="line">    &#125;</div><div class="line">    nodes = scopedSlotFn(props) || fallback;</div><div class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 兼容2.5</span></div><div class="line">    nodes = <span class="keyword">this</span>.$slots[name] || fallback; <span class="comment">// 默认内容</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> target = props &amp;&amp; props.slot;</div><div class="line">  <span class="keyword">if</span> (target) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.$createElement(<span class="string">'template'</span>, &#123; <span class="attr">slot</span>: target &#125;, nodes)</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">return</span> nodes</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="2-6里slot和scope-slot统一到scope-slot-优先从-scopedSlots获取"><a href="#2-6里slot和scope-slot统一到scope-slot-优先从-scopedSlots获取" class="headerlink" title="2.6里slot和scope slot统一到scope slot, 优先从$scopedSlots获取"></a>2.6里slot和scope slot统一到scope slot, 优先从$scopedSlots获取</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">Vue.prototype._render = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">// 子组件render</span></div><div class="line">  <span class="keyword">var</span> vm = <span class="keyword">this</span>;</div><div class="line">  <span class="keyword">var</span> ref = vm.$options;</div><div class="line">  <span class="keyword">var</span> render = ref.render;</div><div class="line">  <span class="keyword">var</span> _parentVnode = ref._parentVnode;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (_parentVnode) &#123;</div><div class="line">    vm.$scopedSlots = normalizeScopedSlots( <span class="comment">// $scopedSlots 来源</span></div><div class="line">      _parentVnode.data.scopedSlots,</div><div class="line">      vm.$slots, <span class="comment">// 兼容2.5</span></div><div class="line">      vm.$scopedSlots</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">normalizeScopedSlots</span> (<span class="params"></span></span></div><div class="line">  slots, <span class="regexp">//</span> 原父组件scope slot</div><div class="line">  normalSlots, <span class="regexp">//</span> 普通$slots</div><div class="line">  prevSlots <span class="regexp">//</span> 反复刷新</div><div class="line">) &#123;</div><div class="line">  <span class="keyword">var</span> res;</div><div class="line">  <span class="keyword">var</span> hasNormalSlots = <span class="built_in">Object</span>.keys(normalSlots).length &gt; <span class="number">0</span>;</div><div class="line">  <span class="keyword">var</span> isStable = slots ? !!slots.$stable : !hasNormalSlots;</div><div class="line">  <span class="keyword">var</span> key = slots &amp;&amp; slots.$key;</div><div class="line">  <span class="keyword">if</span> (!slots) &#123;</div><div class="line">    res = &#123;&#125;;</div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (slots._normalized) &#123;</div><div class="line">    <span class="comment">// fast path 1: child component re-render only, parent did not change</span></div><div class="line">    <span class="keyword">return</span> slots._normalized</div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (</div><div class="line">    isStable &amp;&amp;</div><div class="line">    prevSlots &amp;&amp;</div><div class="line">    prevSlots !== emptyObject &amp;&amp;</div><div class="line">    key === prevSlots.$key &amp;&amp;</div><div class="line">    !hasNormalSlots &amp;&amp;</div><div class="line">    !prevSlots.$hasNormal</div><div class="line">  ) &#123;</div><div class="line">    <span class="comment">// fast path 2: stable scoped slots w/ no normal slots to proxy,</span></div><div class="line">    <span class="comment">// only need to normalize once</span></div><div class="line">    <span class="keyword">return</span> prevSlots</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    res = &#123;&#125;;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key$<span class="number">1</span> <span class="keyword">in</span> slots) &#123;</div><div class="line">      <span class="keyword">if</span> (slots[key$<span class="number">1</span>] &amp;&amp; key$<span class="number">1</span>[<span class="number">0</span>] !== <span class="string">'$'</span>) &#123;</div><div class="line">        res[key$<span class="number">1</span>] = normalizeScopedSlot(normalSlots, key$<span class="number">1</span>, slots[key$<span class="number">1</span>]);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// expose normal slots on scopedSlots</span></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key$<span class="number">2</span> <span class="keyword">in</span> normalSlots) &#123;</div><div class="line">    <span class="keyword">if</span> (!(key$<span class="number">2</span> <span class="keyword">in</span> res)) &#123;</div><div class="line">      res[key$<span class="number">2</span>] = proxyNormalSlot(normalSlots, key$<span class="number">2</span>); <span class="comment">// 代理了vnode</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// avoriaz seems to mock a non-extensible $scopedSlots object</span></div><div class="line">  <span class="comment">// and when that is passed down this would cause an error</span></div><div class="line">  <span class="keyword">if</span> (slots &amp;&amp; <span class="built_in">Object</span>.isExtensible(slots)) &#123;</div><div class="line">    (slots)._normalized = res;</div><div class="line">  &#125;</div><div class="line">  def(res, <span class="string">'$stable'</span>, isStable);</div><div class="line">  def(res, <span class="string">'$key'</span>, key);</div><div class="line">  def(res, <span class="string">'$hasNormal'</span>, hasNormalSlots);</div><div class="line">  <span class="keyword">return</span> res</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="slots来源"><a href="#slots来源" class="headerlink" title="$slots来源"></a>$slots来源</h3><ul>
<li>父组件调用$mount=&gt;编译模板=&gt;父组件渲染调用_render生成vnode</li>
<li>生成app-layout的vnode时, 先创建组件里面的children vnode作为参数传入</li>
<li>创建占位符节点后, patch vnode. </li>
<li>patch时创建组件实例createChildren =&gt;  componentVNodeHooks =&gt; createComponentInstanceForVnode=&gt; 子组件new vue<ul>
<li>子组件流程: init =&gt; initRender =&gt; resolveSlots</li>
</ul>
</li>
</ul>
<h4 id="父组件提供"><a href="#父组件提供" class="headerlink" title="父组件提供"></a>父组件提供</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">Vue.prototype._render = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> ref = vm.$options;</div><div class="line">  <span class="keyword">var</span> render = ref.render;</div><div class="line">  <span class="keyword">var</span> _parentVnode = ref._parentVnode;</div><div class="line">  <span class="keyword">if</span> (_parentVnode) &#123;</div><div class="line">    vm.$scopedSlots = _parentVnode.data.scopedSlots || emptyObject; <span class="comment">// 子组件获取父组件scopedSlots</span></div><div class="line">  &#125;</div><div class="line">  vnode = render.call(vm._renderProxy, vm.$createElement);</div><div class="line">  <span class="comment">// _c('app-layout',...) createElement  </span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">_createElement</span> (<span class="params"></span></span></div><div class="line">  context,</div><div class="line">  tag,</div><div class="line">  data,</div><div class="line">  children,</div><div class="line">  normalizationType</div><div class="line">) &#123;</div><div class="line">  <span class="comment">// support single function children as default scoped slot</span></div><div class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(children) &amp;&amp;</div><div class="line">    <span class="keyword">typeof</span> children[<span class="number">0</span>] === <span class="string">'function'</span></div><div class="line">  ) &#123;</div><div class="line">    data = data || &#123;&#125;;</div><div class="line">    data.scopedSlots = &#123; <span class="attr">default</span>: children[<span class="number">0</span>] &#125;;</div><div class="line">    children.length = <span class="number">0</span>;</div><div class="line">  &#125;</div><div class="line">  vnode = createComponent(Ctor, data, context, children, tag);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createComponent</span> (<span class="params"> <span class="regexp">//</span> 创建组件vnode</span></span></div><div class="line">  Ctor,</div><div class="line">  data,</div><div class="line">  context, <span class="regexp">//</span> _renderProxy</div><div class="line">  children,</div><div class="line">  tag</div><div class="line">) &#123;</div><div class="line">  <span class="keyword">var</span> vnode = <span class="keyword">new</span> VNode(</div><div class="line">    (<span class="string">"vue-component-"</span> + (Ctor.cid) + (name ? (<span class="string">"-"</span> + name) : <span class="string">''</span>)),</div><div class="line">    data, <span class="literal">undefined</span>, <span class="literal">undefined</span>, <span class="literal">undefined</span>, context,</div><div class="line">    &#123; <span class="attr">Ctor</span>: Ctor, <span class="attr">propsData</span>: propsData, <span class="attr">listeners</span>: listeners, <span class="attr">tag</span>: tag, <span class="attr">children</span>: children &#125;,</div><div class="line">    asyncFactory</div><div class="line">  );</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">patch</span> (<span class="params">oldVnode, vnode, hydrating, removeOnly, parentElm, refElm</span>) </span>&#123;</div><div class="line">    createElm(vnode, insertedVnodeQueue, parentElm, refElm); </div><div class="line"></div><div class="line">    invokeInsertHook(vnode, insertedVnodeQueue, isInitialPatch);</div><div class="line">    <span class="keyword">return</span> vnode.elm</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h4 id="子组件获取"><a href="#子组件获取" class="headerlink" title="子组件获取"></a>子组件获取</h4><ul>
<li>流程: init =&gt; initRender =&gt; resolveSlots</li>
<li>2.6后的render里适配成<code>$scopedSlots</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">Vue.prototype._init = <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">initInternalComponent</span> (<span class="params">vm, options</span>) </span>&#123;</div><div class="line">    opts._parentVnode = parentVnode;</div><div class="line">    opts._renderChildren = vnodeComponentOptions.children;</div><div class="line">  &#125;</div><div class="line">  initLifecycle(vm);</div><div class="line">  initEvents(vm);</div><div class="line">  initRender(vm);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">initRender</span> (<span class="params">vm: Component</span>) </span>&#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  <span class="keyword">const</span> parentVnode = vm.$vnode = options._parentVnode <span class="comment">// the placeholder node in parent tree</span></div><div class="line">  <span class="keyword">const</span> renderContext = parentVnode &amp;&amp; parentVnode.context <span class="comment">// 父组件vm做slot的context</span></div><div class="line">  vm.$slots = resolveSlots(options._renderChildren, renderContext)</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Runtime helper for resolving raw children VNodes into a slot object.</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolveSlots</span> (<span class="params"></span></span></div><div class="line">  children,</div><div class="line">  context <span class="regexp">//</span>  父组件vm</div><div class="line">) &#123;</div><div class="line">  <span class="keyword">if</span> (!children || !children.length) &#123;</div><div class="line">    <span class="keyword">return</span> &#123;&#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">var</span> slots = &#123;&#125;;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = children.length; i &lt; l; i++) &#123;</div><div class="line">    <span class="keyword">var</span> child = children[i];</div><div class="line">    <span class="keyword">var</span> data = child.data;</div><div class="line">    <span class="comment">// remove slot attribute if the node is resolved as a Vue slot node</span></div><div class="line">    <span class="keyword">if</span> (data &amp;&amp; data.attrs &amp;&amp; data.attrs.slot) &#123;</div><div class="line">      <span class="keyword">delete</span> data.attrs.slot;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// named slots should only be respected if the vnode was rendered in the</span></div><div class="line">    <span class="comment">// same context.</span></div><div class="line">    <span class="keyword">if</span> ((child.context === context || child.fnContext === context) &amp;&amp;</div><div class="line">      data &amp;&amp; data.slot != <span class="literal">null</span></div><div class="line">    ) &#123; <span class="comment">// 命名slot</span></div><div class="line">      <span class="keyword">var</span> name = data.slot;</div><div class="line">      <span class="keyword">var</span> slot = (slots[name] || (slots[name] = []));</div><div class="line">      <span class="keyword">if</span> (child.tag === <span class="string">'template'</span>) &#123;</div><div class="line">        slot.push.apply(slot, child.children || []);</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        slot.push(child);</div><div class="line">      &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// 默认slot</span></div><div class="line">      (slots.default || (slots.default = [])).push(child);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// ignore slots that contains only whitespace</span></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> name$<span class="number">1</span> <span class="keyword">in</span> slots) &#123;</div><div class="line">    <span class="keyword">if</span> (slots[name$<span class="number">1</span>].every(isWhitespace)) &#123;</div><div class="line">      <span class="keyword">delete</span> slots[name$<span class="number">1</span>];</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> slots</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="scope-slot"><a href="#scope-slot" class="headerlink" title="scope-slot"></a>scope-slot</h2><h3 id="父组件parse-gencode"><a href="#父组件parse-gencode" class="headerlink" title="父组件parse gencode"></a>父组件parse gencode</h3><ul>
<li>添加属性<code>el.slotScope = slotScope;</code></li>
<li>添加属性slotTarget <code>slot=&quot;xxx&quot;</code>如果有的话</li>
<li>在closeElement里除了把节点添加到ast parent的children中(之后又删除), 还增加scopedSlots属性 <code>currentParent.scopedSlots[name] = element</code></li>
<li>生成的render里没有children而是一个函数<code>fn: function(props) {}</code>, 参数就是<code>slot-scope=&quot;props&quot;</code>里面props</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// handle content being passed to a component as slot,</span></div><div class="line"><span class="comment">// e.g. &lt;template slot="xxx"&gt;, &lt;div slot-scope="xxx"&gt;</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">processSlotContent</span> (<span class="params">el</span>) </span>&#123; <span class="comment">// 2.6</span></div><div class="line">  <span class="keyword">var</span> slotScope;</div><div class="line">  <span class="keyword">if</span> (el.tag === <span class="string">'template'</span>) &#123;</div><div class="line">    el.slotScope = slotScope || getAndRemoveAttr(el, <span class="string">'slot-scope'</span>);</div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((slotScope = getAndRemoveAttr(el, <span class="string">'slot-scope'</span>))) &#123;</div><div class="line">    el.slotScope = slotScope;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// slot="xxx"</span></div><div class="line">  <span class="keyword">var</span> slotTarget = getBindingAttr(el, <span class="string">'slot'</span>);</div><div class="line">  <span class="keyword">if</span> (slotTarget) &#123;</div><div class="line">    el.slotTarget = slotTarget === <span class="string">'""'</span> ? <span class="string">'"default"'</span> : slotTarget;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 2.6 v-slot syntax</span></div><div class="line">  &#123;</div><div class="line">    <span class="comment">// ... v-slot:bind可以是scope props或scope target</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">closeElement</span> (<span class="params">element</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (currentParent &amp;&amp; !element.forbidden) &#123;</div><div class="line">      <span class="keyword">if</span> (element.slotScope) &#123;</div><div class="line">        <span class="comment">// scoped slot</span></div><div class="line">        <span class="comment">// keep it in the children list so that v-else(-if) conditions can</span></div><div class="line">        <span class="comment">// find it as the prev node.</span></div><div class="line">        <span class="keyword">var</span> name = element.slotTarget || <span class="string">'"default"'</span></div><div class="line">        ;(currentParent.scopedSlots || (currentParent.scopedSlots = &#123;&#125;))[name] = element;</div><div class="line">      &#125;</div><div class="line">      currentParent.children.push(element); <span class="comment">// 2.5不会把element插入children, 2.6在父element里删除</span></div><div class="line">      element.parent = currentParent;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  element.children = element.children.filter(<span class="function"><span class="keyword">function</span> (<span class="params">c</span>) </span>&#123; <span class="keyword">return</span> !(c).slotScope; &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">genData$2</span> (<span class="params">el, state</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> data = <span class="string">'&#123;'</span>;</div><div class="line">  <span class="comment">// slot target</span></div><div class="line">  <span class="comment">// only for non-scoped slots</span></div><div class="line">  <span class="keyword">if</span> (el.slotTarget &amp;&amp; !el.slotScope) &#123;</div><div class="line">    data += <span class="string">"slot:"</span> + (el.slotTarget) + <span class="string">","</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// scoped slots</span></div><div class="line">  <span class="keyword">if</span> (el.scopedSlots) &#123;</div><div class="line">    data += (genScopedSlots(el, el.scopedSlots, state)) + <span class="string">","</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// component</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">genScopedSlots</span> (<span class="params"></span></span></div><div class="line">  el,</div><div class="line">  slots,</div><div class="line">  state</div><div class="line">) &#123;</div><div class="line">  <span class="keyword">var</span> generatedSlots = <span class="built_in">Object</span>.keys(slots)</div><div class="line">    .map(<span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123; <span class="keyword">return</span> genScopedSlot(slots[key], state); &#125;)</div><div class="line">    .join(<span class="string">','</span>);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> (<span class="string">"scopedSlots:_u(["</span> + generatedSlots + <span class="string">"]"</span> + (needsForceUpdate ? <span class="string">",null,true"</span> : <span class="string">""</span>) + (!needsForceUpdate &amp;&amp; needsKey ? (<span class="string">",null,false,"</span> + (hash(generatedSlots))) : <span class="string">""</span>) + <span class="string">")"</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// &#123;</span></div><div class="line"><span class="comment">//   scopedSlots: _u([</span></div><div class="line"><span class="comment">//     &#123;</span></div><div class="line"><span class="comment">//       key: "default",</span></div><div class="line"><span class="comment">//       fn: function(props) &#123;</span></div><div class="line"><span class="comment">//         return [</span></div><div class="line"><span class="comment">//           _c("p", [_v("Hello from parent " + _s(hello))]), // hello是父vm实例的上的</span></div><div class="line"><span class="comment">//           _c("p", [_v(_s(props.text + props.msg))])</span></div><div class="line"><span class="comment">//         ];</span></div><div class="line"><span class="comment">//       &#125;</span></div><div class="line"><span class="comment">//     &#125;</span></div><div class="line"><span class="comment">//   ]);</span></div><div class="line"><span class="comment">// &#125;</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">genScopedSlot</span> (<span class="params"></span></span></div><div class="line">  el,</div><div class="line">  state</div><div class="line">) &#123;</div><div class="line">  <span class="keyword">var</span> isLegacySyntax = el.attrsMap[<span class="string">'slot-scope'</span>];</div><div class="line">  <span class="keyword">if</span> (el.if &amp;&amp; !el.ifProcessed &amp;&amp; !isLegacySyntax) &#123;</div><div class="line">    <span class="keyword">return</span> genIf(el, state, genScopedSlot, <span class="string">"null"</span>)</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">if</span> (el.for &amp;&amp; !el.forProcessed) &#123;</div><div class="line">    <span class="keyword">return</span> genFor(el, state, genScopedSlot)</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">var</span> slotScope = el.slotScope === emptySlotScopeToken</div><div class="line">    ? <span class="string">""</span></div><div class="line">    : <span class="built_in">String</span>(el.slotScope);</div><div class="line">  <span class="keyword">var</span> fn = <span class="string">"function("</span> + slotScope + <span class="string">")&#123;"</span> +</div><div class="line">    <span class="string">"return "</span> + (el.tag === <span class="string">'template'</span></div><div class="line">      ? el.if &amp;&amp; isLegacySyntax</div><div class="line">        ? (<span class="string">"("</span> + (el.if) + <span class="string">")?"</span> + (genChildren(el, state) || <span class="string">'undefined'</span>) + <span class="string">":undefined"</span>)</div><div class="line">        : genChildren(el, state) || <span class="string">'undefined'</span></div><div class="line">      : genElement(el, state)) + <span class="string">"&#125;"</span>;</div><div class="line">  <span class="comment">// reverse proxy v-slot without scope on this.$slots</span></div><div class="line">  <span class="keyword">var</span> reverseProxy = slotScope ? <span class="string">""</span> : <span class="string">",proxy:true"</span>;</div><div class="line">  <span class="comment">// "function(props)&#123;return [_c('p',[_v("Hello from parent")]),_c('p',[_v(_s(props.text + props.msg))])]&#125;"</span></div><div class="line">  <span class="comment">// &#123;key: 'default', fn: xxx&#125;</span></div><div class="line">  <span class="keyword">return</span> (<span class="string">"&#123;key:"</span> + (el.slotTarget || <span class="string">"\"default\""</span>) + <span class="string">",fn:"</span> + fn + reverseProxy + <span class="string">"&#125;"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="父组件运行时-render"><a href="#父组件运行时-render" class="headerlink" title="父组件运行时/render"></a>父组件运行时/render</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">function resolveScopedSlots (</div><div class="line">  fns, // see flow/vnode</div><div class="line">  res,</div><div class="line">  // the following are added in 2.6</div><div class="line">  hasDynamicKeys,</div><div class="line">  contentHashKey</div><div class="line">) &#123;</div><div class="line">  res = res || &#123; $stable: !hasDynamicKeys &#125;;</div><div class="line">  for (var i = 0; i &lt; fns.length; i++) &#123;</div><div class="line">    var slot = fns[i];</div><div class="line">    if (Array.isArray(slot)) &#123;</div><div class="line">      resolveScopedSlots(slot, res, hasDynamicKeys);</div><div class="line">    &#125; else if (slot) &#123;</div><div class="line">      // marker for reverse proxying v-slot without scope on this.$slots</div><div class="line">      if (slot.proxy) &#123;</div><div class="line">        slot.fn.proxy = true;</div><div class="line">      &#125;</div><div class="line">      res[slot.key] = slot.fn;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  if (contentHashKey) &#123;</div><div class="line">    (res).$key = contentHashKey;</div><div class="line">  &#125;</div><div class="line">  return res</div><div class="line">&#125;</div><div class="line">// scopedSlots: &#123;  </div><div class="line">//   default: renderƒn (props)</div><div class="line">// &#125;</div></pre></td></tr></table></figure>
<h3 id="子组件gencode-render"><a href="#子组件gencode-render" class="headerlink" title="子组件gencode render"></a>子组件gencode render</h3><ul>
<li>genslot时获取slot上绑定的props</li>
<li>render时先获取<code>$scopedSlots</code>, 在执行_t(renderSlot)</li>
<li><code>scopedSlotFn</code>中parent的属性在还是从parent获取, 而slot props从子组件传入的slot props获取</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">genSlot</span> (<span class="params">el, state</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> slotName = el.slotName || <span class="string">'"default"'</span>;</div><div class="line">  <span class="keyword">var</span> children = genChildren(el, state); <span class="comment">// slot包裹子节点</span></div><div class="line">  <span class="keyword">var</span> res = <span class="string">"_t("</span> + slotName + (children ? (<span class="string">","</span> + children) : <span class="string">''</span>);  </div><div class="line">  <span class="keyword">var</span> attrs = el.attrs || el.dynamicAttrs <span class="comment">// 属性的生成 "&#123;"text":"Hello ","msg":msg&#125;"</span></div><div class="line">    ? genProps((el.attrs || []).concat(el.dynamicAttrs || []).map(<span class="function"><span class="keyword">function</span> (<span class="params">attr</span>) </span>&#123; <span class="keyword">return</span> (&#123;</div><div class="line">        <span class="comment">// slot props are camelized</span></div><div class="line">        name: camelize(attr.name),</div><div class="line">        <span class="attr">value</span>: attr.value,</div><div class="line">        <span class="attr">dynamic</span>: attr.dynamic</div><div class="line">      &#125;); &#125;))</div><div class="line">    : <span class="literal">null</span>;</div><div class="line">    ? genProps</div><div class="line">&#125;</div><div class="line"><span class="comment">// with (this) &#123;</span></div><div class="line"><span class="comment">//   return _c(</span></div><div class="line"><span class="comment">//     "div",</span></div><div class="line"><span class="comment">//     &#123; staticClass: "child" &#125;,</span></div><div class="line"><span class="comment">//     [_t("default", null, &#123; text: "Hello ", msg: msg &#125;)], // 执行render是获取了msg</span></div><div class="line"><span class="comment">//     2</span></div><div class="line"><span class="comment">//   );</span></div><div class="line"><span class="comment">// &#125;</span></div></pre></td></tr></table></figure>
<ul>
<li>子组件_render时获取<code>$scopedSlots</code>, 是父组件提供data属性插入的</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Vue.prototype._render = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">// 子组件render </span></div><div class="line">  <span class="keyword">if</span> (_parentVnode) &#123;</div><div class="line">    vm.$scopedSlots = normalizeScopedSlots( <span class="comment">// $scopedSlots 来源</span></div><div class="line">      _parentVnode.data.scopedSlots,</div><div class="line">      vm.$slots, </div><div class="line">      vm.$scopedSlots</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// _t执行</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderSlot</span> (<span class="params"></span></span></div><div class="line">  name,</div><div class="line">  fallback,</div><div class="line">  props,</div><div class="line">  bindObject</div><div class="line">) &#123;</div><div class="line">  <span class="keyword">var</span> scopedSlotFn = <span class="keyword">this</span>.$scopedSlots[name];</div><div class="line">  <span class="keyword">var</span> nodes;</div><div class="line">  <span class="keyword">if</span> (scopedSlotFn) &#123; <span class="comment">// scoped slot</span></div><div class="line">    props = props || &#123;&#125;;</div><div class="line">    <span class="keyword">if</span> (bindObject) &#123;</div><div class="line">      <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; !isObject(bindObject)) &#123;</div><div class="line">        warn(</div><div class="line">          <span class="string">'slot v-bind without argument expects an Object'</span>,</div><div class="line">          <span class="keyword">this</span></div><div class="line">        );</div><div class="line">      &#125;</div><div class="line">      props = extend(extend(&#123;&#125;, bindObject), props);</div><div class="line">    &#125;</div><div class="line">    nodes = scopedSlotFn(props) || fallback;</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    nodes = <span class="keyword">this</span>.$slots[name] || fallback;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> target = props &amp;&amp; props.slot;</div><div class="line">  <span class="keyword">if</span> (target) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.$createElement(<span class="string">'template'</span>, &#123; <span class="attr">slot</span>: target &#125;, nodes)</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">return</span> nodes</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="父组件更新子组件slot"><a href="#父组件更新子组件slot" class="headerlink" title="父组件更新子组件slot"></a>父组件更新子组件slot</h3><ul>
<li>patchVnode =&gt; prepatch =&gt;<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">patchVnode</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> i;</div><div class="line">  <span class="keyword">var</span> data = vnode.data;</div><div class="line">  <span class="keyword">if</span> (isDef(data) &amp;&amp; isDef(i = data.hook) &amp;&amp; isDef(i = i.prepatch)) &#123;</div><div class="line">    i(oldVnode, vnode);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">prepatch: <span class="function"><span class="keyword">function</span> <span class="title">prepatch</span> (<span class="params">oldVnode, vnode</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> options = vnode.componentOptions;</div><div class="line">  <span class="keyword">var</span> child = vnode.componentInstance = oldVnode.componentInstance;</div><div class="line">  updateChildComponent(</div><div class="line">    child,</div><div class="line">    options.propsData, <span class="comment">// updated props</span></div><div class="line">    options.listeners, <span class="comment">// updated listeners</span></div><div class="line">    vnode, <span class="comment">// new parent vnode</span></div><div class="line">    options.children <span class="comment">// new children</span></div><div class="line">  );</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateChildComponent</span> (<span class="params"></span></span></div><div class="line">  vm,</div><div class="line">  propsData,</div><div class="line">  listeners,</div><div class="line">  parentVnode,</div><div class="line">  renderChildren</div><div class="line">) &#123;</div><div class="line"></div><div class="line">  <span class="comment">// determine whether component has slot children</span></div><div class="line">  <span class="comment">// we need to do this before overwriting $options._renderChildren.</span></div><div class="line"></div><div class="line">  <span class="comment">// check if there are dynamic scopedSlots (hand-written or compiled but with</span></div><div class="line">  <span class="comment">// dynamic slot names). Static scoped slots compiled from template has the</span></div><div class="line">  <span class="comment">// "$stable" marker.</span></div><div class="line">  <span class="keyword">var</span> newScopedSlots = parentVnode.data.scopedSlots;</div><div class="line">  <span class="keyword">var</span> oldScopedSlots = vm.$scopedSlots;</div><div class="line">  <span class="keyword">var</span> hasDynamicScopedSlot = !!(</div><div class="line">    (newScopedSlots &amp;&amp; !newScopedSlots.$stable) ||</div><div class="line">    (oldScopedSlots !== emptyObject &amp;&amp; !oldScopedSlots.$stable) ||</div><div class="line">    (newScopedSlots &amp;&amp; vm.$scopedSlots.$key !== newScopedSlots.$key)</div><div class="line">  );</div><div class="line"></div><div class="line">  <span class="comment">// Any static slot children from the parent may have changed during parent's</span></div><div class="line">  <span class="comment">// update. Dynamic scoped slots may also have changed. In such cases, a forced</span></div><div class="line">  <span class="comment">// update is necessary to ensure correctness.</span></div><div class="line">  <span class="keyword">var</span> needsForceUpdate = !!(</div><div class="line">    renderChildren ||               <span class="comment">// has new static slots</span></div><div class="line">    vm.$options._renderChildren ||  <span class="comment">// has old static slots</span></div><div class="line">    hasDynamicScopedSlot</div><div class="line">  );</div><div class="line"></div><div class="line">  vm.$options._parentVnode = parentVnode;</div><div class="line">  vm.$vnode = parentVnode; <span class="comment">// update vm's placeholder node without re-render</span></div><div class="line"></div><div class="line">  <span class="keyword">if</span> (vm._vnode) &#123; <span class="comment">// update child tree's parent</span></div><div class="line">    vm._vnode.parent = parentVnode;</div><div class="line">  &#125;</div><div class="line">  vm.$options._renderChildren = renderChildren;</div><div class="line"></div><div class="line">  <span class="comment">// update $attrs and $listeners hash</span></div><div class="line">  <span class="comment">// these are also reactive so they may trigger child update if the child</span></div><div class="line">  <span class="comment">// used them during render</span></div><div class="line">  vm.$attrs = parentVnode.data.attrs || emptyObject;</div><div class="line">  vm.$listeners = listeners || emptyObject;</div><div class="line"></div><div class="line">  <span class="comment">// update props </span></div><div class="line">  <span class="comment">// update listeners </span></div><div class="line"></div><div class="line">  <span class="comment">// resolve slots + force update if has children</span></div><div class="line">  <span class="keyword">if</span> (needsForceUpdate) &#123;</div><div class="line">    vm.$slots = resolveSlots(renderChildren, parentVnode.context);</div><div class="line">    vm.$forceUpdate();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/vue-slot/" rel="tag"># vue slot</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/05/18/2019-2019-05-18-vue-model/" rel="next" title="vue-model">
                <i class="fa fa-chevron-left"></i> vue-model
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/05/26/2019-2019-06-01-vue-keepalive/" rel="prev" title="vue-keep-alive">
                vue-keep-alive <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">浩齐</p>
              <p class="site-description motion-element" itemprop="description">some kind of blog</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">44</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">61</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#普通slot"><span class="nav-number">1.</span> <span class="nav-text">普通slot</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#父组件parse-阶段"><span class="nav-number">1.1.</span> <span class="nav-text">父组件parse 阶段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#genData-阶段"><span class="nav-number">1.2.</span> <span class="nav-text">genData 阶段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#子组件-compile-parse和gencode阶段"><span class="nav-number">1.3.</span> <span class="nav-text">子组件(compile) parse和gencode阶段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#运行时实现-子组件"><span class="nav-number">1.4.</span> <span class="nav-text">运行时实现(子组件)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-6里slot和scope-slot统一到scope-slot-优先从-scopedSlots获取"><span class="nav-number">1.4.1.</span> <span class="nav-text">2.6里slot和scope slot统一到scope slot, 优先从$scopedSlots获取</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#slots来源"><span class="nav-number">1.5.</span> <span class="nav-text">$slots来源</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#父组件提供"><span class="nav-number">1.5.1.</span> <span class="nav-text">父组件提供</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#子组件获取"><span class="nav-number">1.5.2.</span> <span class="nav-text">子组件获取</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#scope-slot"><span class="nav-number">2.</span> <span class="nav-text">scope-slot</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#父组件parse-gencode"><span class="nav-number">2.1.</span> <span class="nav-text">父组件parse gencode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#父组件运行时-render"><span class="nav-number">2.2.</span> <span class="nav-text">父组件运行时/render</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#子组件gencode-render"><span class="nav-number">2.3.</span> <span class="nav-text">子组件gencode render</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#父组件更新子组件slot"><span class="nav-number">2.4.</span> <span class="nav-text">父组件更新子组件slot</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">浩齐</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
